#!/bin/bash

# اسکریپت اجرای پایپلاین پردازش داده

echo "═══════════════════════════════════════════════════════════"
echo "🚀 پروژه علم داده - فاز ۲"
echo "═══════════════════════════════════════════════════════════"
echo ""

# بررسی وجود Python
if ! command -v python3 &> /dev/null; then
    echo "❌ Python 3 یافت نشد. لطفا ابتدا Python 3 را نصب کنید."
    exit 1
fi

echo "✅ Python $(python3 --version) یافت شد"
echo ""

# بررسی و نصب وابستگی‌ها
echo "📦 بررسی وابستگی‌ها..."
if [ ! -d "venv" ]; then
    echo "🔨 ایجاد محیط مجازی..."
    python3 -m venv venv
fi

echo "🔧 فعال‌سازی محیط مجازی..."
source venv/bin/activate

echo "📥 نصب وابستگی‌ها..."
pip install -q --upgrade pip
pip install -q -r requirements.txt

echo "✅ وابستگی‌ها نصب شدند"
echo ""

# بارگذاری متغیرهای محیطی
if [ -f ".env" ]; then
    echo "🔐 بارگذاری متغیرهای محیطی از .env"
    export $(cat .env | xargs)
fi

# اجرای پایپلاین
echo "▶️  اجرای پایپلاین..."
echo ""
python3 pipeline.py

# بررسی نتیجه
if [ $? -eq 0 ]; then
    echo ""
    echo "═══════════════════════════════════════════════════════════"
    echo "✅ پایپلاین با موفقیت اجرا شد!"
    echo "═══════════════════════════════════════════════════════════"
else
    echo ""
    echo "═══════════════════════════════════════════════════════════"
    echo "❌ خطا در اجرای پایپلاین"
    echo "═══════════════════════════════════════════════════════════"
    exit 1
fi

